# Pizzeria
МДиСУБД, 353501, Малиновская Е. А.

## Описание
Проект представляет собой систему управления пиццерией, включающую функциональность для управления пользователями, заказами, купонами и ролями. Система будет интегрирована с базой данных MySql.

## Функциональные требования
1. **Авторизация/аутентификация пользователя**:
   Система должна обеспечивать возможность пользователям входить в свою учетную запись и выходить из нее.
   Регистрация нового пользователя с проверкой уникальности email.
   Вход в систему с использованием email и пароля.
2. **Управление пользователями (CRUD)**: Система должна предоставлять функциональность для управления пользователями, включая создание, чтение, обновление и удаление учетных записей.
   Администраторы могут создавать новых пользователей.
   Просмотр списка всех пользователей с возможностью фильтрации.
   Обновление информации о пользователях (например, изменение пароля, имени, роли).
   Удаление учетных записей пользователей.
3. **Система ролей**: Система должна поддерживать различные роли пользователей, такие как администратор и клиент.
4. **Журналирование действий пользователя**: Система должна вести журнал действий пользователей для обеспечения безопасности и отслеживания изменений. Возможность просмотра журнала действий администратором. Фильтрация журнала по дате, пользователю и типу действия.
5. **Система заказов**: Система позволяет совершать заказы на одну или несколько пицц, для каждой пиццы можно будет указать количество ингредиентов. Заказы помещаются в корзине и имеют несколько статусов: готовится, доставка, принят. Все сделанные заказы отображаются в корзине.
6. **Система купонов и скидок**: Система предоставляет возможность использовать единоразово купоны или многоразово скидки на позиции. 
7. **Workflow**: В корзине пользователь получает возможность просматривать все выбранные позиции, изменять количество каждой пиццы, удалять ненужные позиции, видеть общую сумму заказа и применять купоны или скидки. Система купонов и скидок работает по разным принципам: купоны являются единоразовыми с уникальным кодом, проходят автоматическую проверку на минимальную сумму заказа и срок действия, тогда как скидки применяются автоматически при выполнении определенных условий, таких как сумма заказа или выбор конкретных категорий пицц, могут быть многоразовыми и имеют различные типы начисления.
После применения всех скидок пользователь переходит к оформлению заказа, где выбирает адрес доставки из сохраненных или добавляет новый с указанием города, улицы, номера дома, квартиры, этажа и комментария для курьера, а также выбирает способ оплаты. После подтверждения заказа система присваивает ему статус "принят", заказ поступает на кухню где статус меняется на "готовится", после приготовления статус обновляется на "доставка" с уведомлением пользователя о выезде курьера, и после успешной доставки заказ переходит в статус "выполнен". Все сделанные заказы сохраняются в истории заказов пользователя с возможностью просмотра деталей каждого заказа.

## Список таблиц для БД:
 Miro: https://miro.com/app/board/uXjVJNeyQ_I=/?share_link_id=351665143686
 
## Описание таблиц:
1. User (Пользователь)
Назначение: Учетные записи пользователей системы
Поля:
user_id: Уникальный идентификатор пользователя (PK)
email: Электронная почта для входа и уведомлений
phone_number: Контактный телефон
name: Полное имя пользователя
role: Роль в системе (клиент, администратор, курьер)
password_hash: Хэш пароля для аутентификации
profile_picture: Аватар пользователя
Связи: Имеет много Address. Имеет одну Cart.

2. Pizza (Пицца)
Назначение: Меню пиццерии, имеющиеся пиццы.
Поля: 
pizza_id: Уникальный идентификатор пиццы (PK).
name: Название пиццы.
description: Описание состава и особенностей.
Связь: Входит в многие Order_Item. Содержит несколько Ingredient. 

3. Category (Категория)
Назначение: Группировка пицц по ингредиентам
Поля:
category_id: Уникальный идентификатор категории (PK)
name: Название категории (например, "Классические", "Острые")
description: Описание категории
Связи: Содержит много Ingredient.

4. Order (Заказ)
Назначение: Информация о заказе.
Поля: 
order_id: Уникальный идентификатор заказа (PK).
cart_id: Идентификатор корзины (FK), в которую добавлен заказ.
created_at: Дата и время создания заказа.
amount: Общая сумма заказа.
status: Статус заказа (например, "в обработке", "доставлен").
coupon_id: Идентификатор примененного купона (FK).
discount_id: Идентификатор примененной скидки (FK).
Связь: Содержит много Order_Item, имеет один Cart. Использует Coupon или Discount.

5. Order_Item (Элемент заказа)
Назначение: Что именно и в каком количестве заказано.
Поля:
order_item_id: Уникальный идентификатор элемента заказа (PK).
order_id: Идентификатор заказа (FK), к которому принадлежит элемент.
pizza_id: Идентификатор пиццы (FK), которая входит в заказ.
amount: Количество данной пиццы в заказе.
Связь: Принадлежит Order. Ссылается на Pizza.

6. Address (Адрес доставки)
Назначение: Адреса доставки пользователей
Поля:
address_id: Уникальный идентификатор адреса (PK)
user_id: Идентификатор пользователя-владельца (FK)
city: Город доставки
street: Улица
house: Номер дома
apartment: Номер квартиры
floor: Этаж
comment: Комментарий для курьера
is_default: Флаг адреса по умолчанию
Связи: Принадлежит User. Используется в многих Order.

7. Cart (Корзина)
Назначение: Хранение заказов.
Поля:
cart_id: Уникальный идентификатор корзины (PK).
user_id: Идентификатор пользователя (FK), которому принадлежит корзина.
order: Идентификатор связанного заказа (FK).
Связь: Содержит много Order. Есть у каждого User.

8. Ingredient (Ингредиент)
Назначение: Составляющие компоненты для пицц
Поля:
ingredient_id: Уникальный идентификатор ингредиента (PK)
name: Название ингредиента
price: Стоимость добавления ингредиента
category_id: Идентификатор категории ингредиентов (FK)
Связи: Принадлежит Category. Используется в многих Pizza.

9. Coupon
Поля:
coupon_id: Уникальный идентификатор купона (PK)
name: Название купона
code: Уникальный код для активации
amount: Размер скидки
min_order_amount: Минимальная сумма заказа для применения
valid_from: Дата начала действия
valid_until: Дата окончания действия
is_active: Флаг активности купона
Связи: Используется в многих Order.

10. Discount
Поля:
discount_id: Уникальный идентификатор скидки (PK).
name: Название акции
code: Код акции
amount: Размер скидки
condition: Условия применения скидки
valid_from: Дата начала действия
valid_until: Дата окончания действия
is_active: Флаг активности скидки
Связи: Используется в многих Order.
